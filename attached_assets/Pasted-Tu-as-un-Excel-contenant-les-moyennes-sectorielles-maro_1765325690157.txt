Tu as un Excel contenant les moyennes sectorielles marocaines pour 20 secteurs.
Chaque secteur a des milliers de donnÃ©es (indicateurs, tailles d'entreprisesâ€¦).

â¡ï¸ Tu veux importer ce fichier une seule fois dans ton projet, et que ton API puisse rÃ©pondre :

Â« Donne-moi la moyenne pour le secteur BTP, tranche 20â€“50 employÃ©s, indicateur "DÃ©chets annuels". Â»

Sans que toi OU tes utilisateurs voient ou gÃ¨rent le fichier.

ğŸ§  Solution professionnelle (et simple)
Ã‰TAPE 1 â€” Convertir ton Excel en base de donnÃ©es

Tu vas convertir ton Excel en un tableau SQL propre :

ğŸ“Œ Structure recommandÃ©e

CrÃ©er une table SQL : sector_averages

id	secteur	tranche_employes	indicateur	valeur
1	Agroalimentaire	1â€“10	dÃ©chets_tonnes_an	12
2	Agroalimentaire	11â€“50	dÃ©chets_tonnes_an	22
3	Textile	1â€“10	Ã©nergie_kwh_an	8120
â€¦	â€¦	â€¦	â€¦	â€¦

Câ€™est simple, robuste, et ton app peut interroger la table en temps rÃ©el.

Ã‰TAPE 2 â€” Importer le fichier Excel automatiquement

Tu nâ€™as PAS besoin de tout taper Ã  la main.
Le backend peut faire l'import directement.

ğŸ”§ MÃ©thode simple (NestJS + TypeScript)

Utiliser :

xlsx â†’ pour lire le fichier Excel

npm install xlsx


Ajouter un script dâ€™import :

import * as XLSX from "xlsx";
import { PrismaClient } from "@prisma/client";

const prisma = new PrismaClient();

async function importExcel() {
  const workbook = XLSX.readFile("./data/moyennes_secteurs.xlsx");
  const sheet = workbook.Sheets[workbook.SheetNames[0]];
  const json = XLSX.utils.sheet_to_json(sheet);

  for (const row of json) {
    await prisma.sectorAverages.create({
      data: {
        secteur: row["Secteur"],
        tranche_employes: row["Tranche"],
        indicateur: row["Indicateur"],
        valeur: Number(row["Valeur"]),
      },
    });
  }

  console.log("Import terminÃ© !");
}

importExcel();


Tu l'exÃ©cutes une seule fois :

npx ts-node import-excel.ts


â¡ï¸ Toutes tes donnÃ©es sectorielles sont dans ta base.

Ã‰TAPE 3 â€” API automatique pour rÃ©cupÃ©rer les moyennes

CrÃ©er un endpoint :

@Get("moyenne")
async getAverage(
  @Query("secteur") secteur: string,
  @Query("tranche") tranche: string,
  @Query("indicateur") indicateur: string
) {
  return this.prisma.sectorAverages.findFirst({
    where: { secteur, tranche_employes: tranche, indicateur }
  });
}

Ã‰TAPE 4 â€” Calcul du score (comme dans ton document)

Chaque fois que l'utilisateur saisit un indicateur :

L'app appelle l'API pour garder la moyenne sectorielle

Compare valeur entreprise vs moyenne

Calcule :

ğ‘’
ËŠ
ğ‘
ğ‘
ğ‘Ÿ
ğ‘¡
=
(
ğ‘£
ğ‘
ğ‘™
ğ‘’
ğ‘¢
ğ‘Ÿ
_
ğ‘’
ğ‘›
ğ‘¡
ğ‘Ÿ
ğ‘’
ğ‘
ğ‘Ÿ
ğ‘–
ğ‘ 
ğ‘’
âˆ’
ğ‘š
ğ‘œ
ğ‘¦
ğ‘’
ğ‘›
ğ‘›
ğ‘’
)
ğ‘š
ğ‘œ
ğ‘¦
ğ‘’
ğ‘›
ğ‘›
ğ‘’
Ã—
100
e
ËŠ
cart=
moyenne
(valeur_entrepriseâˆ’moyenne)
	â€‹

Ã—100

Applique coefficient Ã— signe

Renvoie score

ğŸ’¥ Score = 100% automatique
Aucun besoin de gÃ©rer ou modifier lâ€™Excel aprÃ¨s lâ€™import.

ğŸ§© BONUS â€” Tu veux mett